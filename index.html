<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Journeynest - Local Booking</title>
    
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #f4f4f4; }
        header { background-color: #ff6a00; color: white; padding: 20px; text-align: center; }
        .container { width: 80%; margin: 20px auto; }
        .search-form { background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); margin-bottom: 30px; }
        .hotel-card { background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05); margin-bottom: 15px; border-left: 5px solid #ff6a00; }
        .hotel-card h3 { color: #333; margin-top: 0; }
        .room-details { font-size: 0.9em; color: #555; }
        .error { color: red; text-align: center; }
        label { display: block; margin-top: 10px; font-weight: bold; }
        input[type="date"], button { padding: 10px; margin-top: 5px; width: 100%; box-sizing: border-box; border-radius: 4px; border: 1px solid #ccc; }
        button { background-color: #333; color: white; cursor: pointer; border: none; }
        button:hover { background-color: #555; }
    </style>
</head>
<body>

    <header>
        <h1>Journeynest.online</h1>
        <p>आपके शहर के लिए सबसे कम कमीशन पर बुकिंग।</p>
    </header>

    <div class="container">
        
        <div class="search-form">
            <h2>होटल खोजें (Aurangabad)</h2>
            <div id="loading" style="text-align: center; display: none;">डेटा लोड हो रहा है...</div>
            <div id="search-inputs">
                <label for="checkIn">चेक-इन</label>
                <input type="date" id="checkIn" required>
                
                <label for="checkOut">चेक-आउट</label>
                <input type="date" id="checkOut" required>

                <button onclick="fetchHotels()">होटल खोजें</button>
            </div>
        </div>

        <div id="hotel-list">
            <p id="initial-message">खोज करने के लिए ऊपर तारीखें चुनें।</p>
        </div>

    </div>

    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>

    <script>
        // *** 5a. FIREBASE CONFIGURATION ***
        // NOTE: आपको यहां अपनी वास्तविक Firebase Key डालनी होगी
        // यह कुंजी आपको Firebase Console > Project Settings (Settings Icon) में मिलेगी।
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY", // <--- यह बदलें
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com", // <--- यह बदलें
            projectId: "YOUR_PROJECT_ID", // <--- यह बदलें
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "SENDER_ID",
            appId: "APP_ID"
        };

        // Firebase शुरू करें
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const hotelListDiv = document.getElementById('hotel-list');
        const loadingDiv = document.getElementById('loading');
        
        // *** 5b. FETCH DATA FUNCTION ***
        async function fetchHotels() {
            loadingDiv.style.display = 'block';
            hotelListDiv.innerHTML = '';
            
            const checkIn = document.getElementById('checkIn').value;
            const checkOut = document.getElementById('checkOut').value;

            if (!checkIn || !checkOut) {
                alert('कृपया चेक-इन और चेक-आउट की तारीखें चुनें।');
                loadingDiv.style.display = 'none';
                return;
            }

            try {
                // केवल 'Aurangabad' शहर के होटलों को पढ़ें
                const hotelsRef = db.collection("hotels").where("cityName", "==", "Aurangabad");
                const snapshot = await hotelsRef.get();

                if (snapshot.empty) {
                    hotelListDiv.innerHTML = '<p class="error">क्षमा करें, इस शहर में कोई होटल नहीं मिला।</p>';
                    return;
                }

                // हर होटल के लिए डेटा दिखाएं
                const hotelPromises = snapshot.docs.map(async doc => {
                    const hotelData = doc.data();
                    const hotelId = doc.id;
                    
                    // उस होटल के कमरे के प्रकार (room_types) पढ़ें
                    const roomsRef = db.collection("room_types").where("hotelId", "==", hotelId);
                    const roomsSnapshot = await roomsRef.get();
                    
                    let roomsHtml = '';
                    roomsSnapshot.forEach(roomDoc => {
                        const roomData = roomDoc.data();
                        
                        roomsHtml += `
                            <div class="room-details">
                                <h4>${roomData.name}</h4>
                                <p><strong>कमरे का साइज़:</strong> ${roomData.sqFootage || 'N/A'} sq. ft. (आपकी समस्या का समाधान!)</p>
                                <p><strong>बेडिंग:</strong> ${roomData.bedConfig}</p>
                                <p><strong>मेहमान:</strong> ${roomData.maxGuests}</p>
                                <p><strong>शुरुआती कीमत:</strong> ₹${roomData.basePrice} / रात</p>
                                </div>
                        `;
                    });

                    return `
                        <div class="hotel-card">
                            <h3>${hotelData.name}</h3>
                            <p>${hotelData.address}</p>
                            <p>Rating: ${hotelData.starRating || 'N/A'} Stars</p>
                            ${roomsHtml}
                        </div>
                    `;
                });

                const results = await Promise.all(hotelPromises);
                hotelListDiv.innerHTML = results.join('');

            } catch (error) {
                console.error("होटल फ़ेच करने में त्रुटि:", error);
                hotelListDiv.innerHTML = '<p class="error">डेटा लोड करने में कोई त्रुटि आई। कृपया कंसोल देखें।</p>';
            } finally {
                loadingDiv.style.display = 'none';
            }
        }
    </script>
</body>
</html>
